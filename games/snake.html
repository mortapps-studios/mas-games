<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Snake Classic - MortApps Studios</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            transition: background-color 0.3s, color 0.3s;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        /* Theme Variables */
        .theme-neon {
            --background: #0a0a0f;
            --grid: #1a1a2e;
            --snake-head: #00ff88;
            --snake-body: #00cc6a;
            --snake-glow: rgba(0, 255, 136, 0.3);
            --food: #ff0066;
            --food-glow: rgba(255, 0, 102, 0.3);
            --text: #ffffff;
            --accent: #00ff88;
            --secondary: #ff0066;
        }

        .theme-ocean {
            --background: #0a1628;
            --grid: #0f2847;
            --snake-head: #00d4ff;
            --snake-body: #0099cc;
            --snake-glow: rgba(0, 212, 255, 0.3);
            --food: #ff6b35;
            --food-glow: rgba(255, 107, 53, 0.3);
            --text: #ffffff;
            --accent: #00d4ff;
            --secondary: #ff6b35;
        }

        .theme-sunset {
            --background: #1a0a1e;
            --grid: #2d1b30;
            --snake-head: #ff9500;
            --snake-body: #ff6b00;
            --snake-glow: rgba(255, 149, 0, 0.3);
            --food: #ff2d55;
            --food-glow: rgba(255, 45, 85, 0.3);
            --text: #ffffff;
            --accent: #ff9500;
            --secondary: #ff2d55;
        }

        .theme-arctic {
            --background: #0f1419;
            --grid: #1c2530;
            --snake-head: #64ffda;
            --snake-body: #4fd1c5;
            --snake-glow: rgba(100, 255, 218, 0.3);
            --food: #f093fb;
            --food-glow: rgba(240, 147, 251, 0.3);
            --text: #ffffff;
            --accent: #64ffda;
            --secondary: #f093fb;
        }

        body.theme-neon { background-color: var(--background); color: var(--text); }
        body.theme-ocean { background-color: var(--background); color: var(--text); }
        body.theme-sunset { background-color: var(--background); color: var(--text); }
        body.theme-arctic { background-color: var(--background); color: var(--text); }

        /* Header */
        .header {
            width: 100%;
            max-width: 600px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .brand-logo {
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background-color: var(--accent);
        }

        .brand-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .game-stats {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--accent);
        }

        .stat-value.high {
            color: var(--text);
        }

        .btn-pause {
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            background-color: var(--grid);
            transition: opacity 0.2s;
        }

        .btn-pause:hover {
            opacity: 0.7;
        }

        /* Game Container */
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            width: 100%;
            max-width: 600px;
        }

        @media (min-width: 1024px) {
            .game-container {
                flex-direction: row;
                justify-content: center;
            }
        }

        .canvas-wrapper {
            position: relative;
            border-radius: 1rem;
            padding: 1rem;
            background-color: var(--grid);
            flex: 1;
        }

        #gameCanvas {
            display: block;
            border-radius: 0.5rem;
            touch-action: none;
        }

        /* Overlays */
        .overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 1rem;
            background-color: color-mix(in srgb, var(--background) 93%, transparent);
            z-index: 10;
        }

        .overlay.hidden {
            display: none;
        }

        .overlay-content {
            text-align: center;
            padding: 2rem;
        }

        .overlay-emoji {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .overlay-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .overlay-subtitle {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 1.5rem;
        }

        .tip-box {
            font-size: 0.9rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-style: italic;
            background-color: var(--grid);
        }

        .btn-primary {
            padding: 0.75rem 2rem;
            border-radius: 0.75rem;
            border: none;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            background-color: var(--accent);
            color: var(--background);
        }

        .btn-primary:hover {
            transform: scale(1.05);
        }

        .btn-row {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .btn-secondary {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            transition: opacity 0.2s;
            background-color: var(--grid);
            color: var(--text);
        }

        .btn-secondary:hover {
            opacity: 0.7;
        }

        .btn-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Settings */
        .settings-panel {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: left;
            background-color: var(--background);
        }

        .settings-panel.hidden {
            display: none;
        }

        .settings-label {
            font-size: 0.9rem;
            opacity: 0.7;
            display: block;
            margin-bottom: 0.5rem;
        }

        .theme-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .theme-btn {
            padding: 0.4rem 0.8rem;
            border-radius: 0.5rem;
            border: none;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            background-color: var(--grid);
            color: var(--text);
        }

        .theme-btn.active {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .speed-slider {
            width: 100%;
            accent-color: var(--accent);
        }

        .speed-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            opacity: 0.5;
        }

        .controls-hint {
            margin-top: 1.5rem;
            font-size: 0.8rem;
            opacity: 0.5;
        }

        /* Mobile Controls */
        .mobile-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        @media (min-width: 1024px) {
            .mobile-controls {
                display: none;
            }
        }

        .dpad-btn {
            width: 4rem;
            height: 4rem;
            border-radius: 0.75rem;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.1s;
            background-color: var(--grid);
        }

        .dpad-btn:active {
            transform: scale(0.95);
        }

        .dpad-row {
            display: flex;
            gap: 0.5rem;
        }

        /* Game Over specific */
        .score-display {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .new-high-score {
            font-size: 0.9rem;
            color: var(--secondary);
        }

        /* Landscape Warning */
        .landscape-warning {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.85);
        }

        .landscape-warning.show {
            display: flex;
        }

        .landscape-warning-content {
            text-align: center;
            padding: 2rem;
        }

        .landscape-warning-emoji {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .landscape-warning-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .landscape-warning-text {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* Footer */
        .footer {
            margin-top: 1.5rem;
            font-size: 0.75rem;
            opacity: 0.5;
            text-align: center;
        }

        /* Back button */
        .back-btn {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            background-color: var(--grid);
            color: var(--text);
            z-index: 20;
        }
    </style>
</head>
<body class="theme-neon">
    <!-- Landscape Warning -->
    <div id="landscapeWarning" class="landscape-warning">
        <div class="landscape-warning-content">
            <div class="landscape-warning-emoji">üì±</div>
            <p class="landscape-warning-title">Rotate Your Device</p>
            <p class="landscape-warning-text">This game works best in landscape mode</p>
        </div>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="brand">
            <div class="brand-logo">üêç</div>
            <span class="brand-name">MortApps Studios</span>
        </div>
        <div id="gameStats" class="game-stats" style="display: none;">
            <div class="stat">
                <div class="stat-label">SCORE</div>
                <div id="scoreDisplay" class="stat-value">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">HIGH</div>
                <div id="highScoreDisplay" class="stat-value high">0</div>
            </div>
            <button id="pauseBtn" class="btn-pause">‚è∏Ô∏è</button>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container">
        <div class="canvas-wrapper">
            <canvas id="gameCanvas"></canvas>

            <!-- Menu Overlay -->
            <div id="menuOverlay" class="overlay">
                <div class="overlay-content">
                    <div class="overlay-emoji">üêç</div>
                    <h1 class="overlay-title">Snake Classic</h1>
                    <p class="overlay-subtitle">Eat food. Grow longer. Don't hit walls or yourself!</p>
                    
                    <div id="tipBox" class="tip-box" style="display: none;"></div>
                    
                    <button id="playBtn" class="btn-primary">‚ñ∂ Play Game</button>
                    
                    <div class="btn-row">
                        <button id="tipBtn" class="btn-secondary">üí° Get Tip</button>
                        <button id="settingsBtn" class="btn-secondary">‚öôÔ∏è Settings</button>
                    </div>

                    <div id="settingsPanel" class="settings-panel hidden">
                        <div>
                            <label class="settings-label">Theme</label>
                            <div class="theme-buttons">
                                <button class="theme-btn active" data-theme="neon">Neon Cyberpunk</button>
                                <button class="theme-btn" data-theme="ocean">Ocean Depths</button>
                                <button class="theme-btn" data-theme="sunset">Sunset Blaze</button>
                                <button class="theme-btn" data-theme="arctic">Arctic Frost</button>
                            </div>
                        </div>
                        <div>
                            <label class="settings-label">Speed: <span id="speedValue">150</span>ms</label>
                            <input type="range" id="speedSlider" class="speed-slider" min="50" max="250" step="10" value="150">
                            <div class="speed-labels">
                                <span>Fast</span>
                                <span>Slow</span>
                            </div>
                        </div>
                    </div>

                    <p class="controls-hint">PC: Arrow keys or WASD | Mobile: Swipe or buttons</p>
                </div>
            </div>

            <!-- Paused Overlay -->
            <div id="pausedOverlay" class="overlay hidden">
                <div class="overlay-content">
                    <div class="overlay-emoji">‚è∏Ô∏è</div>
                    <h2 class="overlay-title">Paused</h2>
                    <button id="resumeBtn" class="btn-primary">‚ñ∂ Resume</button>
                    <div class="btn-row">
                        <button id="menuFromPauseBtn" class="btn-secondary">üè† Menu</button>
                    </div>
                </div>
            </div>

            <!-- Game Over Overlay -->
            <div id="gameOverOverlay" class="overlay hidden">
                <div class="overlay-content">
                    <div class="overlay-emoji">üíÄ</div>
                    <h2 class="overlay-title">Game Over!</h2>
                    <div id="finalScore" class="score-display">Score: 0</div>
                    <div id="newHighScore" class="new-high-score" style="display: none;">üéâ New High Score!</div>
                    
                    <div id="feedbackBox" class="tip-box"></div>
                    
                    <div class="btn-row">
                        <button id="playAgainBtn" class="btn-primary">üîÑ Play Again</button>
                        <button id="menuFromGameOverBtn" class="btn-secondary">üè† Menu</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Controls -->
        <div id="mobileControls" class="mobile-controls" style="display: none;">
            <button class="dpad-btn" data-dir="UP">‚¨ÜÔ∏è</button>
            <div class="dpad-row">
                <button class="dpad-btn" data-dir="LEFT">‚¨ÖÔ∏è</button>
                <button class="dpad-btn" data-dir="DOWN">‚¨áÔ∏è</button>
                <button class="dpad-btn" data-dir="RIGHT">‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>¬© 2026 MortApps Studios</p>
    </div>

    <script>
        // Game Configuration
        const GRID_SIZE = 20;
        const INITIAL_SPEED = 150;
        const SPEED_INCREMENT = 5;
        const MIN_SPEED = 50;

        // Tips and Feedback (simulated AI responses)
        const TIPS = [
            "Keep your snake near the center to give yourself more reaction time!",
            "Try to create a circular pattern - it helps avoid trapping yourself!",
            "Move deliberately - speed isn't always your friend in tight spots!",
            "Watch where your tail is heading and plan your path accordingly!",
            "Corner yourself less by circling in wide, open patterns!",
            "When the snake gets long, hug the walls to stay organized!",
            "Always leave yourself an escape route when chasing food!",
            "The edges are dangerous - stay away unless necessary!",
            "Try to eat food that's in open spaces, not corners!",
            "Patience wins - don't rush for food if it's risky!"
        ];

        const FEEDBACK_GOOD = [
            "Amazing performance! You're a Snake master! üèÜ",
            "Incredible run! Your skills are top-notch! üåü",
            "Fantastic game! Keep this up and you'll be unstoppable! üí™"
        ];

        const FEEDBACK_MEDIUM = [
            "Great effort! You're getting better each game! üìà",
            "Nice run! With practice, you'll crush that high score! üéØ",
            "Solid performance! Keep playing to improve! üöÄ"
        ];

        const FEEDBACK_LOW = [
            "Good try! Every game makes you stronger! üí™",
            "Keep going! Practice makes perfect! üéÆ",
            "Don't give up! Your next game will be better! ‚≠ê"
        ];

        // Game State
        let gameState = 'menu'; // menu, playing, paused, gameover
        let snake = [{ x: 10, y: 10 }];
        let food = { x: 15, y: 10 };
        let direction = 'RIGHT';
        let nextDirection = 'RIGHT';
        let score = 0;
        let highScore = 0;
        let speed = INITIAL_SPEED;
        let currentTheme = 'neon';
        let gameLoop = null;

        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // DOM Elements
        const menuOverlay = document.getElementById('menuOverlay');
        const pausedOverlay = document.getElementById('pausedOverlay');
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const gameStats = document.getElementById('gameStats');
        const mobileControls = document.getElementById('mobileControls');
        const landscapeWarning = document.getElementById('landscapeWarning');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const highScoreDisplay = document.getElementById('highScoreDisplay');
        const tipBox = document.getElementById('tipBox');
        const feedbackBox = document.getElementById('feedbackBox');
        const finalScore = document.getElementById('finalScore');
        const newHighScore = document.getElementById('newHighScore');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const settingsPanel = document.getElementById('settingsPanel');

        // Theme colors
        const themes = {
            neon: {
                background: '#0a0a0f',
                grid: '#1a1a2e',
                snakeHead: '#00ff88',
                snakeBody: '#00cc6a',
                snakeGlow: 'rgba(0, 255, 136, 0.3)',
                food: '#ff0066',
                foodGlow: 'rgba(255, 0, 102, 0.3)'
            },
            ocean: {
                background: '#0a1628',
                grid: '#0f2847',
                snakeHead: '#00d4ff',
                snakeBody: '#0099cc',
                snakeGlow: 'rgba(0, 212, 255, 0.3)',
                food: '#ff6b35',
                foodGlow: 'rgba(255, 107, 53, 0.3)'
            },
            sunset: {
                background: '#1a0a1e',
                grid: '#2d1b30',
                snakeHead: '#ff9500',
                snakeBody: '#ff6b00',
                snakeGlow: 'rgba(255, 149, 0, 0.3)',
                food: '#ff2d55',
                foodGlow: 'rgba(255, 45, 85, 0.3)'
            },
            arctic: {
                background: '#0f1419',
                grid: '#1c2530',
                snakeHead: '#64ffda',
                snakeBody: '#4fd1c5',
                snakeGlow: 'rgba(100, 255, 218, 0.3)',
                food: '#f093fb',
                foodGlow: 'rgba(240, 147, 251, 0.3)'
            }
        };

        // Initialize
        function init() {
            loadPreferences();
            resizeCanvas();
            window.addEventListener('resize', () => {
                resizeCanvas();
                checkOrientation();
            });
            window.addEventListener('orientationchange', checkOrientation);
            setupControls();
            drawGame();
        }

        function loadPreferences() {
            const savedHighScore = localStorage.getItem('snake_highScore');
            const savedTheme = localStorage.getItem('snake_theme');
            const savedSpeed = localStorage.getItem('snake_speed');

            if (savedHighScore) highScore = parseInt(savedHighScore);
            if (savedTheme && themes[savedTheme]) {
                currentTheme = savedTheme;
                document.body.className = `theme-${currentTheme}`;
                updateThemeButtons();
            }
            if (savedSpeed) {
                speed = parseInt(savedSpeed);
                speedSlider.value = speed;
                speedValue.textContent = speed;
            }
            highScoreDisplay.textContent = highScore;
        }

        function savePreferences() {
            localStorage.setItem('snake_theme', currentTheme);
            localStorage.setItem('snake_speed', speed.toString());
        }

        function resizeCanvas() {
            const wrapper = canvas.parentElement;
            const maxSize = Math.min(wrapper.clientWidth - 32, 450);
            canvas.width = maxSize;
            canvas.height = maxSize;
            drawGame();
        }

        function checkOrientation() {
            const isLandscape = window.innerWidth > window.innerHeight;
            landscapeWarning.classList.toggle('show', !isLandscape && gameState === 'playing');
        }

        // Game Logic
        function startGame() {
            snake = [{ x: 10, y: 10 }];
            food = generateFood(snake);
            direction = 'RIGHT';
            nextDirection = 'RIGHT';
            score = 0;
            speed = parseInt(speedSlider.value);
            gameState = 'playing';

            menuOverlay.classList.add('hidden');
            pausedOverlay.classList.add('hidden');
            gameOverOverlay.classList.add('hidden');
            gameStats.style.display = 'flex';
            mobileControls.style.display = 'flex';
            tipBox.style.display = 'none';
            feedbackBox.textContent = '';
            newHighScore.style.display = 'none';

            updateScore();
            startGameLoop();
        }

        function startGameLoop() {
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(gameStep, speed);
        }

        function stopGameLoop() {
            if (gameLoop) {
                clearInterval(gameLoop);
                gameLoop = null;
            }
        }

        function gameStep() {
            direction = nextDirection;
            const head = { ...snake[0] };

            switch (direction) {
                case 'UP': head.y -= 1; break;
                case 'DOWN': head.y += 1; break;
                case 'LEFT': head.x -= 1; break;
                case 'RIGHT': head.x += 1; break;
            }

            // Check collisions
            if (head.x < 0 || head.x >= GRID_SIZE || head.y < 0 || head.y >= GRID_SIZE) {
                gameOver();
                return;
            }

            if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
                gameOver();
                return;
            }

            const newSnake = [head, ...snake];

            // Check food
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                updateScore();
                food = generateFood(newSnake);
                // Speed up
                if (speed > MIN_SPEED) {
                    speed -= SPEED_INCREMENT;
                    stopGameLoop();
                    startGameLoop();
                }
            } else {
                newSnake.pop();
            }

            snake = newSnake;
            drawGame();
        }

        function generateFood(currentSnake) {
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * GRID_SIZE),
                    y: Math.floor(Math.random() * GRID_SIZE)
                };
            } while (currentSnake.some(seg => seg.x === newFood.x && seg.y === newFood.y));
            return newFood;
        }

        function gameOver() {
            stopGameLoop();
            gameState = 'gameover';

            const isNewHighScore = score > highScore;
            if (isNewHighScore) {
                highScore = score;
                localStorage.setItem('snake_highScore', highScore.toString());
                highScoreDisplay.textContent = highScore;
            }

            finalScore.textContent = `Score: ${score}`;
            newHighScore.style.display = isNewHighScore && score > 0 ? 'block' : 'none';
            feedbackBox.textContent = getFeedback(score, highScore);
            
            gameOverOverlay.classList.remove('hidden');
            gameStats.style.display = 'none';
            mobileControls.style.display = 'none';
        }

        function getFeedback(score, highScore) {
            const percentage = highScore > 0 ? (score / highScore) * 100 : 100;
            if (percentage >= 90) return FEEDBACK_GOOD[Math.floor(Math.random() * FEEDBACK_GOOD.length)];
            if (percentage >= 50) return FEEDBACK_MEDIUM[Math.floor(Math.random() * FEEDBACK_MEDIUM.length)];
            return FEEDBACK_LOW[Math.floor(Math.random() * FEEDBACK_LOW.length)];
        }

        function pauseGame() {
            if (gameState !== 'playing') return;
            stopGameLoop();
            gameState = 'paused';
            pausedOverlay.classList.remove('hidden');
        }

        function resumeGame() {
            if (gameState !== 'paused') return;
            gameState = 'playing';
            pausedOverlay.classList.add('hidden');
            startGameLoop();
        }

        function goToMenu() {
            stopGameLoop();
            gameState = 'menu';
            menuOverlay.classList.remove('hidden');
            pausedOverlay.classList.add('hidden');
            gameOverOverlay.classList.add('hidden');
            gameStats.style.display = 'none';
            mobileControls.style.display = 'none';
        }

        function updateScore() {
            scoreDisplay.textContent = score;
        }

        // Drawing
        function drawGame() {
            const theme = themes[currentTheme];
            const cellSize = canvas.width / GRID_SIZE;

            // Clear
            ctx.fillStyle = theme.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Grid
            ctx.strokeStyle = theme.grid;
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= GRID_SIZE; i++) {
                ctx.beginPath();
                ctx.moveTo(i * cellSize, 0);
                ctx.lineTo(i * cellSize, canvas.height);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, i * cellSize);
                ctx.lineTo(canvas.width, i * cellSize);
                ctx.stroke();
            }

            // Food with glow
            ctx.shadowColor = theme.foodGlow;
            ctx.shadowBlur = 15;
            ctx.fillStyle = theme.food;
            ctx.beginPath();
            ctx.arc(
                food.x * cellSize + cellSize / 2,
                food.y * cellSize + cellSize / 2,
                cellSize / 2 - 2,
                0,
                Math.PI * 2
            );
            ctx.fill();
            ctx.shadowBlur = 0;

            // Snake
            snake.forEach((segment, index) => {
                const isHead = index === 0;
                
                if (isHead) {
                    ctx.shadowColor = theme.snakeGlow;
                    ctx.shadowBlur = 20;
                }
                
                ctx.fillStyle = isHead ? theme.snakeHead : theme.snakeBody;
                
                const padding = 1;
                const radius = 4;
                const x = segment.x * cellSize + padding;
                const y = segment.y * cellSize + padding;
                const width = cellSize - padding * 2;
                const height = cellSize - padding * 2;

                ctx.beginPath();
                ctx.roundRect(x, y, width, height, radius);
                ctx.fill();
                ctx.shadowBlur = 0;

                // Eyes on head
                if (isHead) {
                    ctx.fillStyle = theme.background;
                    const eyeSize = 3;
                    const eyeOffset = cellSize / 4;
                    let eye1X, eye1Y, eye2X, eye2Y;

                    switch (direction) {
                        case 'UP':
                            eye1X = segment.x * cellSize + cellSize / 2 - eyeOffset;
                            eye1Y = segment.y * cellSize + cellSize / 3;
                            eye2X = segment.x * cellSize + cellSize / 2 + eyeOffset;
                            eye2Y = segment.y * cellSize + cellSize / 3;
                            break;
                        case 'DOWN':
                            eye1X = segment.x * cellSize + cellSize / 2 - eyeOffset;
                            eye1Y = segment.y * cellSize + cellSize * 2 / 3;
                            eye2X = segment.x * cellSize + cellSize / 2 + eyeOffset;
                            eye2Y = segment.y * cellSize + cellSize * 2 / 3;
                            break;
                        case 'LEFT':
                            eye1X = segment.x * cellSize + cellSize / 3;
                            eye1Y = segment.y * cellSize + cellSize / 2 - eyeOffset;
                            eye2X = segment.x * cellSize + cellSize / 3;
                            eye2Y = segment.y * cellSize + cellSize / 2 + eyeOffset;
                            break;
                        case 'RIGHT':
                        default:
                            eye1X = segment.x * cellSize + cellSize * 2 / 3;
                            eye1Y = segment.y * cellSize + cellSize / 2 - eyeOffset;
                            eye2X = segment.x * cellSize + cellSize * 2 / 3;
                            eye2Y = segment.y * cellSize + cellSize / 2 + eyeOffset;
                    }

                    ctx.beginPath();
                    ctx.arc(eye1X, eye1Y, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(eye2X, eye2Y, eyeSize, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
        }

        // Controls
        function setupControls() {
            // Keyboard
            document.addEventListener('keydown', handleKeyDown);

            // Buttons
            document.getElementById('playBtn').addEventListener('click', startGame);
            document.getElementById('pauseBtn').addEventListener('click', pauseGame);
            document.getElementById('resumeBtn').addEventListener('click', resumeGame);
            document.getElementById('playAgainBtn').addEventListener('click', startGame);
            document.getElementById('menuFromPauseBtn').addEventListener('click', goToMenu);
            document.getElementById('menuFromGameOverBtn').addEventListener('click', goToMenu);
            document.getElementById('tipBtn').addEventListener('click', showTip);
            document.getElementById('settingsBtn').addEventListener('click', toggleSettings);

            // Speed slider
            speedSlider.addEventListener('input', (e) => {
                speed = parseInt(e.target.value);
                speedValue.textContent = speed;
                savePreferences();
            });

            // Theme buttons
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentTheme = btn.dataset.theme;
                    document.body.className = `theme-${currentTheme}`;
                    updateThemeButtons();
                    savePreferences();
                    drawGame();
                });
            });

            // Mobile D-pad
            document.querySelectorAll('.dpad-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (gameState !== 'playing') return;
                    const newDir = btn.dataset.dir;
                    const opposites = { UP: 'DOWN', DOWN: 'UP', LEFT: 'RIGHT', RIGHT: 'LEFT' };
                    if (direction !== opposites[newDir]) {
                        nextDirection = newDir;
                    }
                });
            });

            // Touch swipe
            let touchStartX = 0;
            let touchStartY = 0;

            canvas.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, { passive: true });

            canvas.addEventListener('touchend', (e) => {
                if (gameState !== 'playing') return;
                const deltaX = e.changedTouches[0].clientX - touchStartX;
                const deltaY = e.changedTouches[0].clientY - touchStartY;
                const minSwipe = 30;

                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    if (deltaX > minSwipe && direction !== 'LEFT') nextDirection = 'RIGHT';
                    else if (deltaX < -minSwipe && direction !== 'RIGHT') nextDirection = 'LEFT';
                } else {
                    if (deltaY > minSwipe && direction !== 'UP') nextDirection = 'DOWN';
                    else if (deltaY < -minSwipe && direction !== 'DOWN') nextDirection = 'UP';
                }
            }, { passive: true });
        }

        function handleKeyDown(e) {
            if (gameState === 'playing') {
                const keyMap = {
                    'ArrowUp': 'UP', 'w': 'UP', 'W': 'UP',
                    'ArrowDown': 'DOWN', 's': 'DOWN', 'S': 'DOWN',
                    'ArrowLeft': 'LEFT', 'a': 'LEFT', 'A': 'LEFT',
                    'ArrowRight': 'RIGHT', 'd': 'RIGHT', 'D': 'RIGHT'
                };

                if (keyMap[e.key]) {
                    const newDir = keyMap[e.key];
                    const opposites = { UP: 'DOWN', DOWN: 'UP', LEFT: 'RIGHT', RIGHT: 'LEFT' };
                    if (direction !== opposites[newDir]) {
                        nextDirection = newDir;
                    }
                    e.preventDefault();
                }

                if (e.key === 'Escape' || e.key === 'p' || e.key === 'P') {
                    pauseGame();
                }
            } else if (gameState === 'paused') {
                if (e.key === 'Escape' || e.key === 'p' || e.key === 'P') {
                    resumeGame();
                }
            } else if (gameState === 'menu' || gameState === 'gameover') {
                if (e.key === 'Enter' || e.key === ' ') {
                    startGame();
                    e.preventDefault();
                }
            }
        }

        function showTip() {
            tipBox.textContent = 'üí° ' + TIPS[Math.floor(Math.random() * TIPS.length)];
            tipBox.style.display = 'block';
        }

        function toggleSettings() {
            settingsPanel.classList.toggle('hidden');
        }

        function updateThemeButtons() {
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === currentTheme);
            });
        }

        // Start
        init();
    </script>
</body>
</html>
